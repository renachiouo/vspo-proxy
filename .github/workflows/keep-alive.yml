name: Keep Render Service Alive

on:
  schedule:
    # 每 10 分鐘執行一次 (Render 免費方案 15 分鐘無流量會睡眠)
    - cron: '*/10 * * * *'
  workflow_dispatch: # 允許手動觸發

jobs:
  ping-service:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Render Service
        run: |
          echo "Pinging https://vspo-proxy.onrender.com ..."
          
          # 使用 curl ping 服務
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET "https://vspo-proxy.onrender.com/api/youtube?lang=cn&no_increment=true" \
            -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            --max-time 60 \
            --retry 2 \
            --retry-delay 5)
          
          echo "Response code: $response"
          
          if [ "$response" -eq 200 ]; then
            echo "✅ Service is alive!"
          else
            echo "⚠️ Service returned HTTP $response"
          fi

      - name: Send notification on failure
        if: failure()
        run: |
          echo "❌ Failed to ping service. The service might be down."
